<section class="slide" id="slide-8">
    <div class="slide-content dense-slide">
        <h2 class="section-label">Artificial Dopamine: Distributed TD Learning</h2>
        <div class="td-diagram fade-in">
            <svg viewBox="0 0 1050 380" class="td-svg-full">
                <!-- Definitions -->
                <defs>
                    <marker id="arrow-green" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                        <path d="M 0 0 L 8 4 L 0 8 Z" fill="#16a34a"/>
                    </marker>
                    <marker id="arrow-orange" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                        <path d="M 0 0 L 8 4 L 0 8 Z" fill="#ea580c"/>
                    </marker>
                    <marker id="arrow-red" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                        <path d="M 0 0 L 8 4 L 0 8 Z" fill="#dc2626"/>
                    </marker>
                </defs>
                
                <!-- Time axis (positioned at bottom, under the diagram) -->
                <line x1="55" y1="315" x2="200" y2="315" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow-orange)"/>
                <text x="128" y="332" text-anchor="middle" font-size="11" fill="#64748b">time</text>
                
                <!-- Time t-1 label -->
                <text x="95" y="30" text-anchor="middle" font-size="13" fill="#9ca3af">Time t−1</text>
                
                <!-- Time t label -->
                <text x="310" y="30" text-anchor="middle" font-size="13" fill="#2563eb" font-weight="600">Time t</text>
                
                <!-- Reward -->
                <rect x="230" y="45" width="70" height="28" rx="4" fill="#fef2f2" stroke="#dc2626" stroke-width="2"/>
                <text x="265" y="64" text-anchor="middle" font-size="13" font-weight="600" fill="#dc2626">Reward</text>
                
                <!-- Faded layers at t-1 -->
                <g opacity="0.4">
                    <rect x="55" y="60" width="80" height="42" rx="5" fill="#eff6ff" stroke="#2563eb" stroke-width="2"/>
                    <text x="95" y="86" text-anchor="middle" font-size="12" fill="#2563eb">Layer 3</text>
                    
                    <rect x="55" y="125" width="80" height="42" rx="5" fill="#eff6ff" stroke="#2563eb" stroke-width="2"/>
                    <text x="95" y="151" text-anchor="middle" font-size="12" fill="#2563eb">Layer 2</text>
                    
                    <rect x="55" y="190" width="80" height="42" rx="5" fill="#eff6ff" stroke="#2563eb" stroke-width="2"/>
                    <text x="95" y="216" text-anchor="middle" font-size="12" fill="#2563eb">Layer 1</text>
                </g>
                
                <!-- Orange dashed arrows: Activations DOWN (upper layer t-1 → lower layer t) -->
                <!-- Layer 3 at t-1 → Layer 2 at t -->
                <path d="M 135 81 C 175 81, 200 146, 260 146" stroke="#ea580c" stroke-width="2" stroke-dasharray="5,3" fill="none" marker-end="url(#arrow-orange)"/>
                <!-- Layer 2 at t-1 → Layer 1 at t -->
                <path d="M 135 146 C 175 146, 200 211, 260 211" stroke="#ea580c" stroke-width="2" stroke-dasharray="5,3" fill="none" marker-end="url(#arrow-orange)"/>
                <!-- Layer 1 at t-1 → State input at t (context) -->
                <path d="M 135 211 C 175 211, 200 270, 260 270" stroke="#ea580c" stroke-width="2" stroke-dasharray="5,3" fill="none" marker-end="url(#arrow-orange)"/>
                
                <!-- Reward broadcast line (red dashed) -->
                <line x1="265" y1="73" x2="265" y2="250" stroke="#dc2626" stroke-width="2" stroke-dasharray="4,3"/>
                
                <!-- Delta boxes with arrows from reward -->
                <g>
                    <rect x="240" y="90" width="30" height="24" rx="3" fill="#fff7ed" stroke="#ea580c" stroke-width="1.5"/>
                    <text x="255" y="107" text-anchor="middle" font-size="11" font-weight="600" fill="#ea580c">δ₃</text>
                </g>
                <g>
                    <rect x="240" y="155" width="30" height="24" rx="3" fill="#fff7ed" stroke="#ea580c" stroke-width="1.5"/>
                    <text x="255" y="172" text-anchor="middle" font-size="11" font-weight="600" fill="#ea580c">δ₂</text>
                </g>
                <g>
                    <rect x="240" y="220" width="30" height="24" rx="3" fill="#fff7ed" stroke="#ea580c" stroke-width="1.5"/>
                    <text x="255" y="237" text-anchor="middle" font-size="11" font-weight="600" fill="#ea580c">δ₁</text>
                </g>
                
                <!-- Active layers at time t -->
                <rect x="280" y="80" width="85" height="42" rx="5" fill="#eff6ff" stroke="#2563eb" stroke-width="2"/>
                <text x="322" y="106" text-anchor="middle" font-size="12" font-weight="500" fill="#2563eb">Layer 3</text>
                
                <rect x="280" y="145" width="85" height="42" rx="5" fill="#eff6ff" stroke="#2563eb" stroke-width="2"/>
                <text x="322" y="171" text-anchor="middle" font-size="12" font-weight="500" fill="#2563eb">Layer 2</text>
                
                <rect x="280" y="210" width="85" height="42" rx="5" fill="#ddd6fe" stroke="#7c3aed" stroke-width="2"/>
                <text x="322" y="236" text-anchor="middle" font-size="12" font-weight="500" fill="#7c3aed">Layer 1</text>
                
                <!-- Green arrows: Info UP (within timestep) -->
                <!-- Layer 1 → Layer 2 (gap between layers) -->
                <line x1="322" y1="208" x2="322" y2="190" stroke="#16a34a" stroke-width="2.5" marker-end="url(#arrow-green)"/>
                <!-- Layer 2 → Layer 3 (gap between layers) -->
                <line x1="322" y1="143" x2="322" y2="125" stroke="#16a34a" stroke-width="2.5" marker-end="url(#arrow-green)"/>
                
                <!-- State input -->
                <rect x="290" y="268" width="65" height="30" rx="5" fill="#dcfce7" stroke="#16a34a" stroke-width="2"/>
                <text x="322" y="288" text-anchor="middle" font-size="11" fill="#166534">State s<tspan baseline-shift="sub" font-size="9">t</tspan></text>
                <!-- State → Layer 1 (gap between State and Layer 1) -->
                <line x1="322" y1="266" x2="322" y2="255" stroke="#16a34a" stroke-width="2.5" marker-end="url(#arrow-green)"/>
                
                <!-- Q outputs from layers -->
                <line x1="365" y1="101" x2="415" y2="101" stroke="#ea580c" stroke-width="2" marker-end="url(#arrow-orange)"/>
                <line x1="365" y1="166" x2="415" y2="166" stroke="#ea580c" stroke-width="2" marker-end="url(#arrow-orange)"/>
                <line x1="365" y1="231" x2="415" y2="231" stroke="#ea580c" stroke-width="2" marker-end="url(#arrow-orange)"/>
                
                <!-- Q boxes -->
                <rect x="420" y="88" width="42" height="26" rx="3" fill="#fef3c7" stroke="#d97706" stroke-width="1.5"/>
                <text x="441" y="106" text-anchor="middle" font-size="11" font-weight="500" fill="#92400e">Q₃</text>
                
                <rect x="420" y="153" width="42" height="26" rx="3" fill="#fef3c7" stroke="#d97706" stroke-width="1.5"/>
                <text x="441" y="171" text-anchor="middle" font-size="11" font-weight="500" fill="#92400e">Q₂</text>
                
                <rect x="420" y="218" width="42" height="26" rx="3" fill="#fef3c7" stroke="#d97706" stroke-width="1.5"/>
                <text x="441" y="236" text-anchor="middle" font-size="11" font-weight="500" fill="#92400e">Q₁</text>
                
                <!-- Curved lines to Average -->
                <path d="M 462 101 C 490 101, 500 140, 530 140" stroke="#ea580c" stroke-width="1.5" fill="none"/>
                <path d="M 462 166 L 530 166" stroke="#ea580c" stroke-width="1.5" fill="none"/>
                <path d="M 462 231 C 490 231, 500 192, 530 192" stroke="#ea580c" stroke-width="1.5" fill="none"/>
                
                <!-- Average box -->
                <rect x="530" y="128" width="80" height="76" rx="5" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
                <text x="570" y="150" text-anchor="middle" font-size="11" font-weight="600" fill="#92400e">Average</text>
                <text x="570" y="166" text-anchor="middle" font-size="9" fill="#92400e">(Q₁+Q₂+Q₃)/3</text>
                <text x="570" y="184" text-anchor="middle" font-size="9" font-weight="600" fill="#dc2626">No backprop!</text>
                <text x="570" y="196" text-anchor="middle" font-size="8" fill="#64748b">(inference only)</text>
                
                <!-- Arrow to Final Q -->
                <line x1="610" y1="166" x2="660" y2="166" stroke="#ea580c" stroke-width="2" marker-end="url(#arrow-orange)"/>
                
                <!-- Final Q bar box -->
                <rect x="665" y="140" width="60" height="52" rx="5" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
                <text x="695" y="162" text-anchor="middle" font-size="10" font-weight="600" fill="#92400e">Final</text>
                <text x="695" y="180" text-anchor="middle" font-size="12" font-weight="600" fill="#92400e">Q̄(s,a)</text>
                
                <!-- Arrow to Action -->
                <line x1="725" y1="166" x2="775" y2="166" stroke="#dc2626" stroke-width="2" marker-end="url(#arrow-red)"/>
                
                <!-- Action box -->
                <rect x="780" y="135" width="80" height="62" rx="5" fill="#fef2f2" stroke="#dc2626" stroke-width="2"/>
                <text x="820" y="160" text-anchor="middle" font-size="12" font-weight="700" fill="#dc2626">Action</text>
                <text x="820" y="176" text-anchor="middle" font-size="10" fill="#dc2626">argmax Q̄</text>
                <text x="820" y="190" text-anchor="middle" font-size="8" fill="#991b1b">(select best action)</text>
                
                <!-- Citation in figure area (bottom right) -->
                <text x="1040" y="370" text-anchor="end" font-size="14" fill="#64748b" font-style="italic">
                    Guan, Verch, Voelcker, Jackson, Papernot &amp; Cunningham — NeurIPS 2024
                </text>
            </svg>
        </div>
        
        <!-- Legend -->
        <div class="td-legend-compact fade-in" style="--delay: 0.5">
            <div class="legend-entry">
                <svg width="24" height="10"><line x1="0" y1="5" x2="20" y2="5" stroke="#16a34a" stroke-width="2.5" marker-end="url(#arrow-green-leg)"/><defs><marker id="arrow-green-leg" markerWidth="5" markerHeight="5" refX="4" refY="2.5" orient="auto"><path d="M 0 0 L 5 2.5 L 0 5 Z" fill="#16a34a"/></marker></defs></svg>
                <span>Info UP (within timestep)</span>
            </div>
            <div class="legend-entry">
                <svg width="24" height="10"><line x1="0" y1="5" x2="20" y2="5" stroke="#ea580c" stroke-width="2" stroke-dasharray="3,2"/></svg>
                <span>Activations DOWN (across time)</span>
            </div>
            <div class="legend-entry">
                <svg width="24" height="10"><line x1="0" y1="5" x2="20" y2="5" stroke="#dc2626" stroke-width="2" stroke-dasharray="3,2"/></svg>
                <span>Reward broadcast</span>
            </div>
            <div class="legend-entry">
                <span class="delta-marker-sm">δ</span>
                <span>Local TD error</span>
            </div>
        </div>
        
        <p class="key-insight-compact fade-in" style="--delay: 1">
            <strong>Key insight:</strong> Each layer independently computes δ = r + γ·max Q(s',a') − Q(s,a) and updates its own weights. No error propagation between layers.
        </p>
    </div>
</section>
